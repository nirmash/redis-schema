# AUTOMATICALLY GENERATED
# DO NOT EDIT THIS FILE DIRECTLY. Edit /Dockerfile.erb and run /update instead.

FROM debian:buster

RUN set -ex \
      && saved_apt_mark="$(apt-mark showmanual)" \
    && apt-get update \
    && apt-get install -y --no-install-recommends \
      ca-certificates \
      curl \
      vim \
      redis \
      gcc \
      unzip \
      libc6-dev \
      make \
              libreadline-dev \
                        && curl -fsSL -o /tmp/lua.tar.gz "https://www.lua.org/ftp/lua-5.4.3.tar.gz" \
                        && curl -fsSL -o /tmp/luarocks.tar.gz "https://luarocks.github.io/luarocks/releases/luarocks-3.8.0.tar.gz" \
  && cd /tmp \
    && echo "1dda2ef23a9828492b4595c0197766de6e784bc7 *lua.tar.gz" | sha1sum -c - \
    && mkdir /tmp/lua \
  && tar -xf /tmp/lua.tar.gz -C /tmp/lua --strip-components=1 \
  && cd /tmp/lua \
      && make linux \
    && make install \
      && apt-mark auto '.*' > /dev/null \
    && cd /tmp \
    && tar xzf luarocks.tar.gz \
    && cd luarocks-3.8.0 \
    && ./configure --with-lua-include=/usr/local/include --with-lua-lib=/usr/local/lib \
    && make \ 
    && make install \
    && luarocks install --tree /usr/local redis-lua \
    && rm -rf /tmp/lua /tmp/lua.tar.gz \
    && rm -rf /tmp/lua /tmp/luarocks.tar.gz \    
    && lua -v

RUN apt-get update
RUN apt-get install -y python3-pip
RUN pip3 install -q redis

WORKDIR /
RUN mkdir src
ADD src src

CMD [ "lua" ]